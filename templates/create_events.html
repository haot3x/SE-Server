<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Hout</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Loading Bootstrap -->

    <link href={{ url_for('static', filename='../static/Flat-UI-master/bootstrap/css/bootstrap.css' )}} rel="stylesheet">
    <link href={{ url_for('static', filename='../static/Flat-UI-master/css/flat-ui.css' )}} rel="stylesheet">
    <link href={{ url_for('static', filename='../static/Flat-UI-master/images/favicon.ico' )}} rel="shortcut icon">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements. All other JS at the end of file. -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
      <script src="js/respond.min.js"></script>
    <![endif]-->
  </head>
  <body style=''> <!--for the navibar always top-->

    <div class='container'>

  <div>
            
        <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-01">
              <span class="sr-only">Toggle navigation</span>
            </button>
            <a class="navbar-brand" id='navi-menu' href = '/'>HOUT</a>
            </div>

            <div class="collapse navbar-collapse" id="navbar-collapse-01">
            <ul class="nav navbar-nav">           
              
              <li id="nav-event-div"><a href='/events'>Events</a></li>
              
              {% if not current_user.is_authenticated() %}  
                <li><a href='/login'>Login</a></li>
              {% else %}
                <li id="nav-propose-div"><a href="{{ url_for('event_api.api_event_create') }}">Propose</a></li>
                <li id="nav-myevents-div"><a href="/event/mine/{{ current_user.id }}">My Events</a></li>
                <li id="nav-myrequest-div"><a href="#">My Requests</a></li>
                <li id="nav-setting-div"><a href="#">Settings</a></li>
                <li><a href='/logout'>Logout - {{ current_user.email }}</a></li>
              {% endif %}
            
            </ul>           

            <form class="navbar-form navbar-right" action="#" role="search">
              <div class="form-group">
                <div class="input-group">
                  <input class="form-control" id="navbarInput-01" type="search" placeholder="Search">
                  <span class="input-group-btn">
                    <button type="Submit" class="btn btn-success"><span class="fui-search"></span></button>
                  </span>            
                </div>
              </div>               
            </form>
            </div><!-- /.navbar-collapse -->

        </nav><!-- /navbar -->



        <div class='row' style='padding-top:53px'>

            <div class="col-md-12">    
                <h4>Create an Event!</h4>                
            </div>
        </div>
    
      
      <div class="col-md-3">

    

      <div class="form-group">
        <input type="text" id="title" placeholder="Event Title" class="form-control" />
        <span class="input-icon fui-new"></span>      
      </div>

    <div class="form-group">
      <input type="text" id="description" placeholder="Description" class="form-control" />
      <span class="input-icon fui-list"></span>      
    </div>

    <div class="form-group">
      <input type="text" id="location" placeholder="Location" class="form-control" />
      <span class="input-icon fui-location"></span>      
    </div>

    <div class="form-group input-append bootstrap-timepicker">
      <input type="text" id="startTime" placeholder="Event Start Time" class="form-control" />
      <span class="input-icon fui-time"></span>      
    </div>

    <div class="form-group input-append bootstrap-timepicker">
      <input type="text" id="endTime" placeholder="Event End Time" class="form-control" />
      <span class="input-icon fui-time"></span>      
    </div>



    <input id='postAjaxBtn' class="btn btn-primary btn-lg btn-block" value='Create' >
    
    <a class="btn btn-warning btn-lg btn-block" href="/" role="button">Cancel</a>
             
  </div>
  
  <div class="col-md-9" id ='mapcanvas' style='height:400px;width:400px;'>
    

  </div>



</div>


    <!-- Load JS here for greater good =============================-->
    <script src={{ url_for('static', filename='../static/Flat-UI-master/js/jquery-1.8.3.min.js')}} ></script>
    <script src={{ url_for('static', filename='../static/Flat-UI-master/js/jquery-ui-1.10.3.custom.min.js')}} ></script>
    <script src={{ url_for('static', filename='../static/Flat-UI-master/js/jquery.ui.touch-punch.min.js')}} ></script>
    <script src={{ url_for('static', filename='../static/Flat-UI-master/js/bootstrap.min.js')}} ></script>
    <script src={{ url_for('static', filename='../static/Flat-UI-master/js/bootstrap-select.js')}} ></script>
    <script src={{ url_for('static', filename='../static/Flat-UI-master/js/bootstrap-switch.js')}} ></script>
    <script src={{ url_for('static', filename='../static/Flat-UI-master/js/flatui-checkbox.js')}} ></script>
    <script src={{ url_for('static', filename='../static/Flat-UI-master/js/flatui-radio.js')}} ></script>
    <script src={{ url_for('static', filename='../static/Flat-UI-master/js/jquery.tagsinput.js')}} ></script>
    <script src={{ url_for('static', filename='../static/Flat-UI-master/js/jquery.placeholder.js')}} ></script>
    <script src={{ url_for('static', filename='../static/Flat-UI-master/js/jquery.scrollTo.min.js')}} ></script>
    
    <script src={{ url_for('static', filename='../static/bootstrap-timepicker/js/bootstrap-timepicker.js')}} ></script>
    <link href={{ url_for('static', filename='../static/bootstrap-timepicker/css/bootstrap-timepicker.css' )}} rel="stylesheet">

    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>


     <script>
      $(document).ready(function() {   
          
        console.log('{{ current_user.email }}');
        console.log('{{ current_user.id }}');

        $('#timse').timepicker({
                minuteStep: 5,
                showInputs: false,
                disableFocus: true
        });

        userID = '{{ current_user.id }}';
        locGeoLat = 0;
        locGeoLng = 0;

        function getZIP(latlng)
        {
          return "06511";
        }

        function getGeoLocation()
        {

          function geoSuccess(position) {
            console.log(position);
            

            locGeoLat = position.coords.latitude;
            locGeoLng = position.coords.longitude;
            // var mapcanvas = document.createElement('div');
            // mapcanvas.id = 'mapcanvas';
            // mapcanvas.style.height = '400px';
            // mapcanvas.style.width = '560px';
              
            // $("#maphere").after(mapcanvas);
            
            var latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
            var myOptions = {
              zoom: 15,
              center: latlng,
              mapTypeControl: false,
              navigationControlOptions: {style: google.maps.NavigationControlStyle.SMALL},
              mapTypeId: google.maps.MapTypeId.ROADMAP
            };

            var map = new google.maps.Map(document.getElementById("mapcanvas"), myOptions);
            
            var marker = new google.maps.Marker({
                position: latlng, 
                map: map, 
                description:$("#title").val(),
                title:"You are here! (at least within a "+position.coords.accuracy+" meter radius)",
                draggable:true
            });
          
          
            google.maps.event.addListener(marker, 'dragend', function(data){
              //alert(this.position.e);
              //alert(this.position.d);
              locGeoLat = this.position.e;
              locGeoLng = this.position.d;
            });

            google.maps.event.addListener(marker, 'click', function(data) {
              var infowindow = new google.maps.InfoWindow();
              infowindow.setContent(this.description);
              infowindow.open(map, this);
            });

          }

          function geoError(msg) {
            console.log(msg);
          }



          navigator.geolocation.getCurrentPosition(geoSuccess, geoError);

        }

        getGeoLocation();
        


          $("#postAjaxBtn").click(function(event){

          var data = {"_method":"POST",
              "title":$("#title").val(),
              "description":$("#description").val(),
              "location":$("#location").val(),
              "startTime":$("#startTime").val(),
              "endTime":$("#endTime").val(),
              "latitude":locGeoLat,
              "longitude":locGeoLng,
              "ZIP":getZIP(locGeoLat + "," + locGeoLng),
              "userID": userID
            }

          var djson = JSON.stringify(data);
          var url = "{{ url_for('event_api.api_event_post') }}";
    
          console.log(djson);
          $.ajax({
              type: "POST",
              url: url,
              data: djson,
              contentType: 'application/json;charset=UTF-8',
              error: function(e) {
                console.log("get an error");
                console.log(e);
              },
              success: function(data){
                window.location = '/events';
               }
            
            });

          });


        });
    </script>
  </body>
</html>
